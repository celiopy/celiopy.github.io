<!doctype html>
<html lang="pt-BR" x-data="app()" :data-theme="theme" class="scroll-smooth">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workflow de Atendimento | Calorias de Bolso</title>
  <!-- CDNs solicitados -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!-- Alpine.js para o passo a passo -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body class="min-h-screen bg-base-200">
  <div class="drawer lg:drawer-open min-h-screen">
    <input id="sidebar" type="checkbox" class="drawer-toggle" />

    <!-- CONTEÚDO PRINCIPAL -->
    <div class="drawer-content flex flex-col">
      <!-- NAVBAR -->
      <header class="navbar bg-base-100 shadow-xs sticky top-0 z-20 gap-3">
        <div class="flex-none lg:hidden">
          <label for="sidebar" aria-label="open sidebar" class="btn btn-ghost btn-square">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5M3.75 17.25h16.5" />
            </svg>
          </label>
        </div>

        <div class="flex-1">
          <a class="btn btn-ghost text-xl font-semibold tracking-tight">Atendimento</a>
        </div>

        <div class="flex-1 max-w-xl">
          <label class="input input-bordered flex items-center gap-2 w-full">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 opacity-70">
              <path fill-rule="evenodd"
                d="M10.5 3.75a6.75 6.75 0 1 0 4.238 12.03l4.241 4.241a.75.75 0 1 0 1.06-1.06l-4.241-4.242A6.75 6.75 0 0 0 10.5 3.75Zm-5.25 6.75a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Z"
                clip-rule="evenodd" />
            </svg>
            <input type="text" class="grow" placeholder="Buscar no app (estático)" />
          </label>
        </div>

        <div class="flex-none">
          <!-- Troca de tema -->
          <label class="swap swap-rotate mr-1">
            <input type="checkbox" @change="theme = $event.target.checked ? 'dark' : 'light'" />
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="swap-off fill-current size-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="swap-on fill-current size-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
            </svg>
          </label>

          <div class="dropdown dropdown-end">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
              <div class="w-10 rounded-full">
                <img alt="avatar" src="https://i.pravatar.cc/100?img=12" />
              </div>
            </div>
            <ul tabindex="0" class="menu dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
              <li><a>Meu Perfil</a></li>
              <li><a>Configurações</a></li>
              <li><a class="text-error">Sair</a></li>
            </ul>
          </div>
        </div>
      </header>

      <!-- PÁGINA: Workflow do Atendimento -->
      <main class="p-4 lg:p-6 space-y-6">
        <div class="breadcrumbs text-sm">
          <ul>
            <li><a>Dashboard</a></li>
            <li><a>Atendimentos</a></li>
            <li>Workflow</li>
          </ul>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
          <!-- COLUNA PRINCIPAL (2/3): Steps + Conteúdo -->
          <section class="xl:col-span-2 flex flex-col gap-4">
            <div class="card bg-base-100 shadow rounded-2xl">
              <div class="card-body gap-4">
                <!-- Cabeçalho do atendimento -->
                <div class="flex flex-wrap items-center justify-between gap-4">
                  <div class="flex items-center gap-4">
                    <div class="avatar">
                      <div class="w-14 rounded-full"><img :src="paciente.avatar" alt="avatar" /></div>
                    </div>
                    <div>
                      <h2 class="text-xl font-bold" x-text="paciente.nome"></h2>
                      <p class="text-sm opacity-70">Objetivo: <span x-text="paciente.objetivo"></span></p>
                    </div>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="badge" :class="status === 'Em andamento' ? 'badge-primary' : 'badge-success'"
                      x-text="status"></span>
                    <span class="badge badge-outline">ID #<span x-text="atendimentoId"></span></span>
                  </div>
                </div>

                <!-- Steps -->
                <ul class="steps steps-vertical lg:steps-horizontal w-full">
                  <template x-for="(label, idx) in steps" :key="idx">
                    <li class="step cursor-pointer" :class="{ 'step-primary': idx <= step }" @click="setStep(idx)"
                      :aria-current="idx === step ? 'step' : null">
                      <span x-text="label"></span>
                    </li>
                  </template>
                </ul>


                <!-- Conteúdo dinâmico da etapa -->
                <div class="space-y-4">
                  <!-- Etapa 0: Anamnese -->
                  <div x-show="step===0" x-transition>
                    <div class="card bg-base-200">
                      <div class="card-body">
                        <h3 class="card-title">Anamnese</h3>
                        <div class="flex flex-col gap-4">
                          <label class="flex flex-col gap-2"><span class="label-text">Histórico médico</span>
                            <textarea class="w-full textarea textarea-bordered" placeholder="Descreva"
                              x-model="dados.anamnese.historico"></textarea>
                          </label>
                          <label class="flex flex-col gap-2"><span class="label-text">Alergias</span>
                            <input class="w-full input input-bordered" placeholder="Ex.: lactose, glúten"
                              x-model="dados.anamnese.alergias" />
                          </label>
                          <label class="flex flex-col gap-2 md:col-span-2"><span class="label-text">Restrições /
                              Medicações</span>
                            <textarea class="w-full textarea textarea-bordered"
                              placeholder="Restrições, uso de fármacos" x-model="dados.anamnese.restricoes"></textarea>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Etapa 1: Avaliação -->
                  <div x-show="step===1" x-transition>
                    <div class="card bg-base-200">
                      <div class="card-body">
                        <h3 class="card-title">Avaliação</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                          <label class="form-control"><span class="label-text">Peso (kg)</span>
                            <input type="number" step="0.1" class="input input-bordered"
                              x-model.number="dados.avaliacao.peso" @input="calcularIMC()" />
                          </label>
                          <label class="form-control"><span class="label-text">Altura (cm)</span>
                            <input type="number" class="input input-bordered" x-model.number="dados.avaliacao.altura"
                              @input="calcularIMC()" />
                          </label>
                          <label class="form-control"><span class="label-text">IMC</span>
                            <input type="text" class="input input-bordered" x-model="dados.avaliacao.imc" readonly />
                          </label>
                          <label class="form-control"><span class="label-text">BF% (opcional)</span>
                            <input type="number" step="0.1" class="input input-bordered"
                              x-model.number="dados.avaliacao.bf" />
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Etapa 2: Plano de Dieta (com refeições e alimentos) -->
                  <div x-show="step===2" x-transition>
                    <div class="card bg-base-200">
                      <div class="card-body space-y-4">
                        <h3 class="card-title">Plano de Dieta</h3>

                        <!-- Alvos -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                          <label class="form-control"><span class="label-text">Kcal/dia (alvo)</span>
                            <input type="number" class="input input-bordered" x-model.number="dados.dieta.kcal"
                              @input="recalcDieta()" />
                          </label>
                          <label class="form-control"><span class="label-text">Proteína alvo (g)</span>
                            <input type="number" class="input input-bordered" x-model.number="dados.dieta.proteina"
                              @input="recalcDieta()" />
                          </label>
                          <label class="form-control"><span class="label-text">Carbo alvo (g)</span>
                            <input type="number" class="input input-bordered" x-model.number="dados.dieta.carbo"
                              @input="recalcDieta()" />
                          </label>
                          <label class="form-control"><span class="label-text">Gordura alvo (g)</span>
                            <input type="number" class="input input-bordered" x-model.number="dados.dieta.gordura"
                              @input="recalcDieta()" />
                          </label>
                        </div>

                        <!-- Adicionar alimento -->
                        <div class="grid grid-cols-1 lg:grid-cols-12 gap-3 items-end">

                          <!-- Refeição -->
                          <label class="form-control lg:col-span-2">
                            <span class="label-text">Refeição</span>
                            <select class="select select-bordered" x-model="alimentoForm.refeicao">
                              <template x-for="r in dados.dieta.refeicoes" :key="r.nome">
                                <option :value="r.nome" x-text="r.nome"></option>
                              </template>
                            </select>
                          </label>

                          <label class="form-control lg:col-span-3 relative" x-data="{ 
    isOpen: false,
    highlightedIndex: -1,
    filteredAlimentos: [],
    selectItem(a) {
      alimentoForm.nome = a.nome;
      updateAlimentoForm();
      this.filteredAlimentos = [];
      this.isOpen = false;
    }
  }" x-init="
$watch('highlightedIndex', value => {
    const list = $refs.list;
    if (!list) return;

    // seleciona o próximo item
    const nextEl = list.children[value + 1];
    if (nextEl) {
        nextEl.scrollIntoView({ block: 'nearest' });
    }
});">
                            <span class="label-text">Alimento</span>

                            <input type="text" class="input input-bordered" x-model="alimentoForm.nome"
                              placeholder="Digite ou selecione..." @focus="isOpen = true" @blur="isOpen = false"
                              @input="isOpen = true, filteredAlimentos = alimentosBase.filter(a => a.nome.toLowerCase().includes(alimentoForm.nome.toLowerCase()))"
                              @keydown.arrow-down.prevent="highlightedIndex = Math.min(highlightedIndex + 1, filteredAlimentos.length - 1)"
                              @keydown.arrow-up.prevent="highlightedIndex = Math.max(highlightedIndex - 1, 0)"
                              @keydown.enter.prevent="highlightedIndex >= 0 && selectItem(filteredAlimentos[highlightedIndex])" />

                            <ul x-show="isOpen && filteredAlimentos.length > 0" x-ref="list"
                              class="absolute z-50 bg-base-100 max-h-40 overflow-auto w-full border rounded-lg">
                              <template x-for="(a, index) in filteredAlimentos" :key="a.nome">
                                <li @mousedown.prevent="selectItem(a)"
                                  :class="highlightedIndex === index ? 'bg-primary text-primary-content' : 'hover:bg-primary hover:text-primary-content'"
                                  class="p-2 cursor-pointer">
                                  <span x-text="a.nome"></span>
                                </li>
                              </template>
                            </ul>
                          </label>




                          <!-- Quantidade -->
                          <label class="form-control lg:col-span-2">
                            <span class="label-text">Qtd</span>
                            <input type="number" class="input input-bordered" x-model.number="alimentoForm.qtd"
                              @input="updateQtd()" />
                          </label>

                          <!-- Unidade -->
                          <label class="form-control lg:col-span-1">
                            <span class="label-text">Un.</span>
                            <input class="input input-bordered" x-model="alimentoForm.unidade" readonly />
                          </label>

                          <!-- Kcal -->
                          <label class="form-control lg:col-span-1">
                            <span class="label-text">Kcal</span>
                            <input type="number" class="input input-bordered" x-model="alimentoForm.kcal" readonly />
                          </label>

                          <!-- Prot -->
                          <label class="form-control lg:col-span-1">
                            <span class="label-text">P</span>
                            <input type="number" class="input input-bordered" x-model="alimentoForm.prot" readonly />
                          </label>

                          <!-- Carb -->
                          <label class="form-control lg:col-span-1">
                            <span class="label-text">C</span>
                            <input type="number" class="input input-bordered" x-model="alimentoForm.carb" readonly />
                          </label>

                          <!-- Gord -->
                          <label class="form-control lg:col-span-1">
                            <span class="label-text">G</span>
                            <input type="number" class="input input-bordered" x-model="alimentoForm.gord" readonly />
                          </label>

                          <!-- Botão -->
                          <button class="btn btn-primary lg:col-span-12" @click="addAlimento()">Adicionar
                            alimento</button>
                        </div>



                        <!-- Refeições -->
                        <template x-for="(ref, rIdx) in dados.dieta.refeicoes" :key="ref.nome">
                          <div class="bg-base-100 rounded-xl border p-4">
                            <div class="flex items-center justify-between">
                              <h4 class="font-semibold" x-text="ref.nome"></h4>
                              <div class="text-sm opacity-70">Total: <span x-text="fmt(ref.tot.kcal)"></span> kcal · P
                                <span x-text="fmt(ref.tot.prot)"></span> · C <span x-text="fmt(ref.tot.carb)"></span> ·
                                G <span x-text="fmt(ref.tot.gord)"></span>
                              </div>
                            </div>
                            <div class="overflow-x-auto mt-2">
                              <table class="table table-sm">
                                <thead>
                                  <tr>
                                    <th>Alimento</th>
                                    <th>Qtd</th>
                                    <th>Kcal</th>
                                    <th>P</th>
                                    <th>C</th>
                                    <th>G</th>
                                    <th class="text-right">Ações</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <template x-for="(it, idx) in ref.itens" :key="idx">
                                    <tr>
                                      <td x-text="it.nome"></td>
                                      <td><span x-text="it.qtd"></span> <span x-text="it.unidade"></span></td>
                                      <td x-text="fmt(it.kcal)"></td>
                                      <td x-text="fmt(it.prot)"></td>
                                      <td x-text="fmt(it.carb)"></td>
                                      <td x-text="fmt(it.gord)"></td>
                                      <td class="text-right">
                                        <button class="btn btn-ghost btn-xs"
                                          @click="rmAlimento(rIdx, idx)">remover</button>
                                      </td>
                                    </tr>
                                  </template>
                                  <tr x-show="ref.itens.length===0">
                                    <td colspan="7" class="opacity-60">Sem itens</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </template>

                        <!-- Totais & Progresso -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div class="card bg-base-100 border">
                            <div class="card-body">
                              <h4 class="font-semibold">Totais do dia</h4>
                              <div class="space-y-2 text-sm">
                                <div>Kcal: <span x-text="fmt(totaisDieta.kcal)"></span> / <span
                                    x-text="dados.dieta.kcal"></span>
                                  <progress class="progress w-full"
                                    :value="Math.min(totaisDieta.kcal, dados.dieta.kcal)"
                                    :max="dados.dieta.kcal"></progress>
                                </div>
                                <div>Proteína (g): <span x-text="fmt(totaisDieta.prot)"></span> / <span
                                    x-text="dados.dieta.proteina"></span>
                                  <progress class="progress w-full"
                                    :value="Math.min(totaisDieta.prot, dados.dieta.proteina)"
                                    :max="dados.dieta.proteina"></progress>
                                </div>
                                <div>Carbo (g): <span x-text="fmt(totaisDieta.carb)"></span> / <span
                                    x-text="dados.dieta.carbo"></span>
                                  <progress class="progress w-full"
                                    :value="Math.min(totaisDieta.carb, dados.dieta.carbo)"
                                    :max="dados.dieta.carbo"></progress>
                                </div>
                                <div>Gordura (g): <span x-text="fmt(totaisDieta.gord)"></span> / <span
                                    x-text="dados.dieta.gordura"></span>
                                  <progress class="progress w-full"
                                    :value="Math.min(totaisDieta.gord, dados.dieta.gordura)"
                                    :max="dados.dieta.gordura"></progress>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="card bg-base-100 border">
                            <div class="card-body">
                              <h4 class="font-semibold">Observações</h4>
                              <textarea class="textarea textarea-bordered w-full" x-model="dados.dieta.obs"
                                placeholder="Preferências, horários, restrições..."></textarea>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Etapa 3: Plano de Treino -->
                  <div x-show="step===3" x-transition>
                    <div class="space-y-6">

                      <!-- Configuração do Treino -->
                      <div class="card bg-base-200 shadow-md">
                        <div class="card-body">
                          <h3 class="card-title">Plano de Treino</h3>
                          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                            <label class="form-control">
                              <span class="label-text">Divisão</span>
                              <select class="select select-bordered" x-model="dados.treino.divisao"
                                @change="montarSessoes()">
                                <option>ABC</option>
                                <option>AB</option>
                                <option>Full body</option>
                                <option>Superior/Inferior</option>
                              </select>
                            </label>

                            <label class="form-control">
                              <span class="label-text">Sessões/sem</span>
                              <input type="number" min="1" max="7" class="input input-bordered"
                                x-model.number="dados.treino.sessoes" />
                            </label>

                            <label class="form-control">
                              <span class="label-text">Observações</span>
                              <input class="input input-bordered" x-model="dados.treino.obs"
                                placeholder="Lesões, limitações..." />
                            </label>
                          </div>
                        </div>
                      </div>

                      <!-- Adicionar Exercício -->
                      <div class="card bg-base-100 border shadow-sm">
                        <div class="card-body">
                          <h4 class="font-semibold mb-2">Adicionar Exercício</h4>
                          <div class="grid grid-cols-1 lg:grid-cols-12 gap-3 items-end">
                            <label class="form-control lg:col-span-2">
                              <span class="label-text">Sessão</span>
                              <select class="select select-bordered" x-model="exForm.sessao">
                                <template x-for="s in dados.treino.sessoesLista" :key="s">
                                  <option x-text="s"></option>
                                </template>
                              </select>
                            </label>

                            <label class="form-control lg:col-span-4">
                              <span class="label-text">Exercício</span>
                              <input class="input input-bordered" x-model="exForm.nome"
                                placeholder="Ex.: Supino reto" />
                            </label>

                            <label class="form-control lg:col-span-2">
                              <span class="label-text">Séries</span>
                              <input type="number" class="input input-bordered" x-model.number="exForm.series" />
                            </label>

                            <label class="form-control lg:col-span-2">
                              <span class="label-text">Reps</span>
                              <input type="number" class="input input-bordered" x-model.number="exForm.reps" />
                            </label>

                            <label class="form-control lg:col-span-2">
                              <span class="label-text">Carga (kg)</span>
                              <input type="number" step="0.5" class="input input-bordered"
                                x-model.number="exForm.carga" />
                            </label>

                            <button class="btn btn-primary lg:col-span-12" @click="addExercicio()">
                              Adicionar exercício
                            </button>
                          </div>
                        </div>
                      </div>

                      <!-- Sessões / Tabs -->
                      <div class="tabs tabs-boxed">
                        <template x-for="(sess, sIdx) in dados.treino.sessoesDados" :key="sess.nome">
                          <a role="tab" class="tab" :class="{ 'tab-active': treinoTab === sIdx }"
                            @click="treinoTab = sIdx">
                            Sessão <span x-text="sess.nome"></span>
                          </a>
                        </template>
                      </div>

                      <div class="mt-4 space-y-4">
                        <template x-for="(sess, sIdx) in dados.treino.sessoesDados" :key="sess.nome">
                          <div x-show="treinoTab === sIdx" class="bg-base-100 rounded-xl border p-4 shadow-sm">
                            <div class="flex items-center justify-between mb-2">
                              <h4 class="font-semibold">Sessão <span x-text="sess.nome"></span></h4>
                              <div class="text-sm opacity-70">
                                Exercícios: <span x-text="sess.exercicios.length"></span> ·
                                Volume: <span x-text="fmt(sess.volume)"></span> kg-rep
                              </div>
                            </div>

                            <div class="overflow-x-auto">
                              <table class="table table-sm">
                                <thead>
                                  <tr>
                                    <th>Exercício</th>
                                    <th>Séries</th>
                                    <th>Reps</th>
                                    <th>Carga</th>
                                    <th>Volume</th>
                                    <th class="text-right">Ações</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <template x-for="(ex, idx) in sess.exercicios" :key="idx">
                                    <tr>
                                      <td x-text="ex.nome"></td>
                                      <td x-text="ex.series"></td>
                                      <td x-text="ex.reps"></td>
                                      <td><span x-text="fmt(ex.carga)"></span> kg</td>
                                      <td x-text="fmt(ex.series*ex.reps*ex.carga)"></td>
                                      <td class="text-right">
                                        <button class="btn btn-ghost btn-xs"
                                          @click="rmExercicio(sIdx, idx)">remover</button>
                                      </td>
                                    </tr>
                                  </template>
                                  <tr x-show="sess.exercicios.length===0">
                                    <td colspan="6" class="opacity-60 text-center">Sem exercícios</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </template>
                      </div>

                      <!-- Totais e Observações -->
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="card bg-base-100 border p-4 shadow-sm">
                          <h4 class="font-semibold mb-2">Totais de Treino</h4>
                          <div class="text-sm space-y-1">
                            <div>Sessões semanais: <span x-text="dados.treino.sessoes"></span></div>
                            <div>Exercícios (total): <span x-text="totaisTreino.exercicios"></span></div>
                            <div>Volume total: <span x-text="fmt(totaisTreino.volume)"></span> kg-rep</div>
                          </div>
                        </div>

                        <div class="card bg-base-100 border p-4 shadow-sm">
                          <h4 class="font-semibold mb-2">Observações</h4>
                          <textarea class="textarea textarea-bordered w-full" x-model="dados.treino.obs"
                            placeholder="Notas adicionais..."></textarea>
                        </div>
                      </div>

                    </div>
                  </div>


                  <!-- Etapa 4: Feedback & Ajustes -->
                  <div x-show="step===4" x-transition>
                    <div class="card bg-base-200">
                      <div class="card-body">
                        <h3 class="card-title">Feedback & Ajustes</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <label class="form-control"><span class="label-text">Feedback do paciente</span>
                            <textarea class="textarea textarea-bordered" x-model="dados.feedback.paciente"></textarea>
                          </label>
                          <label class="form-control"><span class="label-text">Ajustes do profissional</span>
                            <textarea class="textarea textarea-bordered" x-model="dados.feedback.ajustes"></textarea>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Etapa 5: Finalização -->
                  <div x-show="step===5" x-transition>
                    <div class="alert">
                      <span>Revise os dados resumidos abaixo e confirme a finalização.</span>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                      <div class="card bg-base-100 border">
                        <div class="card-body">
                          <h4 class="font-semibold">Resumo</h4>
                          <ul class="text-sm space-y-1">
                            <li><span class="opacity-70">Paciente: </span><span x-text="paciente.nome"></span></li>
                            <li><span class="opacity-70">Objetivo: </span><span x-text="paciente.objetivo"></span></li>
                            <li><span class="opacity-70">IMC: </span><span x-text="dados.avaliacao.imc || '—'"></span>
                            </li>
                            <li><span class="opacity-70">Dieta (totais): </span><span
                                x-text="fmt(totaisDieta.kcal)"></span>kcal · P<span
                                x-text="fmt(totaisDieta.prot)"></span> · C<span x-text="fmt(totaisDieta.carb)"></span> ·
                              G<span x-text="fmt(totaisDieta.gord)"></span></li>
                            <li><span class="opacity-70">Treino: </span><span x-text="dados.treino.divisao"></span> ·
                              <span x-text="dados.treino.sessoes"></span>x/sem · Volume <span
                                x-text="fmt(totaisTreino.volume)"></span>
                            </li>
                          </ul>
                        </div>
                      </div>
                      <div class="card bg-base-100 border">
                        <div class="card-body">
                          <h4 class="font-semibold">Confirmação</h4>
                          <label class="label cursor-pointer justify-start gap-3">
                            <input type="checkbox" class="checkbox" x-model="dados.finalizacao.confirmado" />
                            <span class="label-text">Confirmo que revisei as informações com o paciente.</span>
                          </label>
                          <button class="btn btn-success mt-2" :disabled="!dados.finalizacao.confirmado"
                            @click="finalizar()">Finalizar atendimento</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Navegação entre etapas -->
                <div class="flex flex-wrap items-center justify-between gap-2 pt-2">
                  <div class="join">
                    <button class="btn join-item" @click="prev()" :disabled="step===0">Voltar</button>
                    <button class="btn join-item" @click="saveStep()">Salvar</button>
                    <button class="btn btn-primary join-item" @click="next()"
                      :disabled="step===steps.length-1">Avançar</button>
                  </div>
                  <div class="text-sm opacity-70">Etapa <span x-text="step+1"></span> de <span
                      x-text="steps.length"></span> — <span x-text="steps[step]"></span></div>
                </div>
              </div>
            </div>
          </section>

          <!-- COLUNA LATERAL (1/3): Informações e Ações -->
          <aside class="xl:col-span-1">
            <div class="card bg-base-100 shadow rounded-2xl sticky top-20">
              <div class="card-body gap-4">
                <h3 class="card-title">Atendimento</h3>
                <div class="grid grid-cols-2 gap-3 text-sm">
                  <div><span class="opacity-70">Profissional</span>
                    <div class="font-medium">Dr(a). Alex Santos</div>
                  </div>
                  <div><span class="opacity-70">Cliente</span>
                    <div class="font-medium" x-text="paciente.nome"></div>
                  </div>
                  <div><span class="opacity-70">Objetivo</span>
                    <div class="font-medium" x-text="paciente.objetivo"></div>
                  </div>
                  <div><span class="opacity-70">Status</span>
                    <div class="font-medium" x-text="status"></div>
                  </div>
                </div>

                <div class="divider my-2"></div>

                <div class="form-control w-full">
                  <label class="label"><span class="label-text">Modo</span></label>
                  <select class="select select-bordered" x-model="modo">
                    <option value="solo">Atendendo</option>
                    <option value="acompanhar">Acompanhando um atendente</option>
                  </select>
                </div>

                <div class="alert" x-show="modo==='acompanhar'" x-transition>
                  <span>Você está em modo de acompanhamento. Edição bloqueada (demo).</span>
                </div>

                <div class="grid grid-cols-2 gap-2">
                  <button class="btn btn-outline" @click="resetar()">Resetar</button>
                  <button class="btn btn-error" @click="cancelar()">Cancelar</button>
                </div>

                <div class="divider my-2"></div>

<h4 class="font-semibold">Notas rápidas</h4>

<textarea
  class="textarea textarea-bordered"
  placeholder="Anotações avulsas"
  :value="notas"
  @input="notas = $event.target.value"
></textarea>

<button
  class="btn btn-ghost mt-2"
  @click="notas=''; notify('Notas limpas')"
  :disabled="!notas || notas.trim() === ''"
>
  Limpar notas
</button>

              </div>
            </div>
          </aside>
        </div>
      </main>

      <!-- TOASTS -->
      <div class="toast toast-end">
        <template x-for="t in toasts" :key="t.id">
          <div x-transition class="alert alert-success mb-2">
            <span x-text="t.msg"></span>
          </div>
        </template>
      </div>
    </div>

    <!-- SIDEBAR -->
    <div class="drawer-side z-100">
      <label for="sidebar" aria-label="close sidebar" class="drawer-overlay"></label>
      <aside class="p-4 w-56 min-h-full bg-base-100 shadow-xl">
        <img src="logo.png" alt="" style="object-fit: cover" class="w-full h-[8rem]">
        <div class="hidden px-2 py-3 mb-2">
          <div class="text-sm opacity-70">Profissional</div>
          <div class="font-semibold">Dr(a). Alex Santos</div>
          <div class="badge badge-outline mt-1">Nutrição & Treinamento</div>
        </div>
        <ul class="menu w-full">
          <li><a class="active"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                stroke-width="1.5" stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0 0 20.25 18V6A2.25 2.25 0 0 0 18 3.75H6A2.25 2.25 0 0 0 3.75 6v12A2.25 2.25 0 0 0 6 20.25Z" />
              </svg>
              Dashboard</a></li>
          <li>
            <details open>
              <summary><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
                Pacientes</summary>
              <ul>
                <li><a>Lista</a></li>
                <li><a>Grupos</a></li>
              </ul>
            </details>
          </li>
          <li>
            <details open>
              <summary class="bg-base-300"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0 1 18 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3 1.5 1.5 3-3.75" />
                </svg>
                Atendimentos</summary>
              <ul>
                <li><a>Lista</a></li>
                <li><a>Em andamento</a></li>
                <li><a>Agendados</a></li>
                <li><a>Concluídos</a></li>
              </ul>
            </details>
          </li>
          <li>
            <details>
              <summary><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="size-5">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M6 6.878V6a2.25 2.25 0 0 1 2.25-2.25h7.5A2.25 2.25 0 0 1 18 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 0 0 4.5 9v.878m13.5-3A2.25 2.25 0 0 1 19.5 9v.878m0 0a2.246 2.246 0 0 0-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0 1 21 12v6a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 18v-6c0-.98.626-1.813 1.5-2.122" />
                </svg>
                Biblioteca</summary>
              <ul>
                <li><a>Dietas</a></li>
                <li><a>Treinos</a></li>
              </ul>
            </details>
          </li>
          <li><a><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
              </svg>
              Agenda</a></li>
          <li><a><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
              </svg>
              Relatórios</a></li>
          <li><a><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              </svg>
              Configurações</a></li>
        </ul>
      </aside>
    </div>
  </div>

  <script src="script.js"></script>
</body>

</html>